<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1411px" preserveAspectRatio="none" style="width:1739px;height:1411px;background:#FFFFFF;" version="1.1" viewBox="0 0 1739 1411" width="1739px" zoomAndPan="magnify"><defs/><g><rect fill="#87CEEB" height="26.2969" id="_title" style="stroke:#808080;stroke-width:1.0;" width="187" x="774.875" y="15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="177" x="779.875" y="32.9951">$provide-dispensation</text><ellipse cx="1060.75" cy="57.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="none" height="1227.5508" style="stroke:#000000;stroke-width:1.5;" width="1717.75" x="11" y="77.2969"/><path d="M98,77.2969 L98,86.5938 L88,96.5938 L11,96.5938 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="14" y="91.292">transaction</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="702" x="709.75" y="167.5625"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="69" x="719.75" y="188.7012">Validate all</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="78" x="792.75" y="188.7012">Medication</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="4" x="870.75" y="188.7012">,</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="93" x="878.75" y="188.7012">Organization</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="24" x="975.75" y="188.7012">and</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1003.75" y="188.7012">Practitioner</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="310" x="1091.75" y="188.7012">for the RxDispensation from Operation parameter</text><polygon fill="#F1F1F1" points="999.25,221.5313,1122.25,221.5313,1134.25,233.5313,1122.25,245.5313,999.25,245.5313,987.25,233.5313,999.25,221.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="999.25" y="237.3394">Validation successfull</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="967.25" y="230.937">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1134.25" y="230.937">no</text><polygon fill="#F1F1F1" points="249.5,255.5313,777.5,255.5313,789.5,267.5313,777.5,279.5313,249.5,279.5313,237.5,267.5313,249.5,255.5313" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="7" x="249.5" y="271.3394">If</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="123" x="260.5" y="271.3394">MedicationRequest</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="23" x="387.5" y="271.3394">with</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="201" x="414.5" y="271.3394">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="158" x="619.5" y="271.3394">exists in Medication Service</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="223.5" y="264.937">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="789.5" y="264.937">yes</text><rect fill="#FFC0CB" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="309" x="23" y="289.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="289" x="33" y="310.6699">Return "OperationOutcome (duplicate failure)"</text><ellipse cx="177.5" cy="368.5" fill="none" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;"/><line style="stroke:#222222;stroke-width:2.5;" x1="171.3128" x2="183.6872" y1="362.3128" y2="374.6872"/><line style="stroke:#222222;stroke-width:2.5;" x1="183.6872" x2="171.3128" y1="362.3128" y2="374.6872"/><rect fill="#F1F1F1" height="61.9063" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="776" x="461.5" y="289.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="39" x="729" y="310.6699">Set all</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="144" x="772" y="310.6699">MedicationDispense</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="920" y="310.6699">with the</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="321" x="471.5" y="324.6387">extension[RxPrescriptionProcessIdentifier] equal to</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="223" x="796.5" y="324.6387">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="200" x="1023.5" y="324.6387">from Item of the RxDispensation</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="219" x="708" y="338.6074">in the Medication Service to Status</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="60" x="931" y="338.6074">declined</text><rect fill="#F1F1F1" height="61.9063" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="568" x="565.5" y="386.4375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="39" x="762" y="407.5762">Set all</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="78" x="805" y="407.5762">Medication</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="887" y="407.5762">with the</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="321" x="575.5" y="421.5449">extension[RxPrescriptionProcessIdentifier] equal to</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="223" x="900.5" y="421.5449">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="791" y="435.5137">to Status</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="55" x="853" y="435.5137">inactive</text><rect fill="#F1F1F1" height="85.875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="292" x="703.5" y="468.3438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="771" y="489.4824">&lt;&lt; Create or Update &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="93" x="803" y="503.4512">Organization</text><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="995.5" y1="511.2813" y2="511.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="995.5" y1="513.2813" y2="513.2813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="272" x="713.5" y="527.4199">identifier[TelematikID] = Value(TelematikID)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="12" x="843.5" y="541.3887">...</text><rect fill="none" height="608.6914" style="stroke:#000000;stroke-width:1.5;" width="1089.75" x="352" y="564.2188"/><path d="M392,564.2188 L392,573.5156 L382,583.5156 L352,583.5156 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="355" y="578.2139">loop</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="549" x="575" y="654.4844"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="585" y="675.623">Get the related</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="78" x="685" y="675.623">Medication</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="42" x="767" y="675.623">for the</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="144" x="813" y="675.623">MedicationDispense</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="961" y="675.623">from the RxDispensation</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="359" x="670" y="714.9336"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="680" y="736.0723">Generate Hash for</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="219" x="800" y="736.0723">EPAMedicationUniqueIdentifier</text><polygon fill="#F1F1F1" points="596,768.9023,1103,768.9023,1115,788.1094,1103,807.3164,596,807.3164,584,788.1094,596,768.9023" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="141" x="614.5" y="779.1128">Verify whether there is a</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="71" x="759.5" y="779.1128">Medication</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="45" x="834.5" y="779.1128">with the</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="201" x="883.5" y="779.1128">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="21" x="839" y="791.9175">and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="600" y="804.7222">the generated hash for the</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="199" x="758" y="804.7222">EPAMedicationUniqueIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="961" y="804.7222">in the Medication Service</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="564" y="785.5151">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1115" y="785.5151">no</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="404" x="372" y="817.3164"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="382" y="838.4551">Update</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="78" x="432" y="838.4551">Medication</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="25" x="514" y="838.4551">with</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="223" x="543" y="838.4551">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="24" x="396.5" y="852.4238">and</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="219" x="424.5" y="852.4238">EPAMedicationUniqueIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="647.5" y="852.4238">to Status</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="42" x="709.5" y="852.4238">active</text><rect fill="#F1F1F1" height="113.8125" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="571" x="839.5" y="817.3164"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="90" x="1080" y="838.4551">&lt;&lt; Create &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="78" x="1086" y="852.4238">Medication</text><line style="stroke:#181818;stroke-width:1.0;" x1="839.5" x2="1410.5" y1="860.2539" y2="860.2539"/><line style="stroke:#181818;stroke-width:1.0;" x1="839.5" x2="1410.5" y1="862.2539" y2="862.2539"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="900" y="876.3926">identifier[</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="219" x="960" y="876.3926">EPAMedicationUniqueIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171" x="1179" y="876.3926">] = Value(Generated Hash)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="849.5" y="890.3613">extension[</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="223" x="915.5" y="890.3613">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="262" x="1138.5" y="890.3613">] = Value(RxPrescriptionProcessIdentifier)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="1075" y="904.3301">status =</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1133" y="904.3301">active</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="12" x="1119" y="918.2988">...</text><polygon fill="#F1F1F1" points="849.5,937.1289,861.5,949.1289,849.5,961.1289,837.5,949.1289,849.5,937.1289" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="127.7813" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="571" x="564" y="981.1289"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="90" x="804.5" y="1002.2676">&lt;&lt; Create &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="144" x="777.5" y="1016.2363">MedicationDispense</text><line style="stroke:#181818;stroke-width:1.0;" x1="564" x2="1135" y1="1024.0664" y2="1024.0664"/><line style="stroke:#181818;stroke-width:1.0;" x1="564" x2="1135" y1="1026.0664" y2="1026.0664"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="574" y="1040.2051">extension[</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="223" x="640" y="1040.2051">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="262" x="863" y="1040.2051">] = Value(RxPrescriptionProcessIdentifier)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="220" x="698" y="1054.1738">medicationReference = Reference(</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="78" x="918" y="1054.1738">Medication</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="5" x="996" y="1054.1738">)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186" x="707.5" y="1068.1426">performer.actor = Reference(</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="93" x="893.5" y="1068.1426">Organization</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="5" x="986.5" y="1068.1426">)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="231" x="663" y="1082.1113">authorizingPrescription = Reference(</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="137" x="894" y="1082.1113">MedicationRequest</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="5" x="1031" y="1082.1113">)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="783.5" y="1096.0801">status =</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="74" x="841.5" y="1096.0801">completed</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="382" x="658.5" y="600.5156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="53" x="672.5" y="621.6543">Get next</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="144" x="729.5" y="621.6543">MedicationDispense</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="877.5" y="621.6543">from the RxDispensation</text><polygon fill="#F1F1F1" points="665,1128.9102,1034,1128.9102,1046,1140.9102,1034,1152.9102,665,1152.9102,653,1140.9102,665,1128.9102" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="853.5" y="1163.1206">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="35" x="665" y="1144.7183">If next</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="130" x="704" y="1144.7183">MedicationDispense</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="196" x="838" y="1144.7183">in Operation Parameter List exists</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="1046" y="1138.3159">yes</text><rect fill="#F1F1F1" height="47.9375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="438" x="630.5" y="1192.9102"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="21" x="640.5" y="1214.0488">Set</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="137" x="665.5" y="1214.0488">MedicationRequest</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="25" x="806.5" y="1214.0488">with</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="223" x="835.5" y="1214.0488">RxPrescriptionProcessIdentifier</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="781.5" y="1228.0176">to Status</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="74" x="843.5" y="1228.0176">completed</text><rect fill="#FFC0CB" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="247" x="1451.75" y="255.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="227" x="1461.75" y="276.6699">Return "OperationOutcome (failure)"</text><ellipse cx="1575.25" cy="334.5" fill="none" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;"/><line style="stroke:#222222;stroke-width:2.5;" x1="1569.0628" x2="1581.4372" y1="328.3128" y2="340.6872"/><line style="stroke:#222222;stroke-width:2.5;" x1="1581.4372" x2="1569.0628" y1="328.3128" y2="340.6872"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="397" x="862.25" y="113.5938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="377" x="872.25" y="134.7324">Get next Item from Operation Parameter RxDispensation List</text><polygon fill="#F1F1F1" points="883.25,1260.8477,1238.25,1260.8477,1250.25,1272.8477,1238.25,1284.8477,883.25,1284.8477,871.25,1272.8477,883.25,1260.8477" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1064.75" y="1295.0581">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="355" x="883.25" y="1276.6558">If next Item in Operation Parameter RxDispensation List exists</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="1250.25" y="1270.2534">yes</text><rect fill="#98FB98" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="259" x="931.25" y="1324.8477"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="239" x="941.25" y="1345.9863">Return "OperationOutcome (success)"</text><ellipse cx="1060.75" cy="1389.8164" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="1060.75" cy="1389.8164" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="177.5" x2="177.5" y1="323.5" y2="358.5"/><polygon fill="#181818" points="173.5,348.5,177.5,358.5,181.5,348.5,177.5,352.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="351.4375" y2="386.4375"/><polygon fill="#181818" points="845.5,376.4375,849.5,386.4375,853.5,376.4375,849.5,380.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="448.3438" y2="468.3438"/><polygon fill="#181818" points="845.5,458.3438,849.5,468.3438,853.5,458.3438,849.5,462.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="688.4531" y2="714.9336"/><polygon fill="#181818" points="845.5,704.9336,849.5,714.9336,853.5,704.9336,849.5,708.9336" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="584" x2="574" y1="788.1094" y2="788.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="574" x2="574" y1="788.1094" y2="817.3164"/><polygon fill="#181818" points="570,807.3164,574,817.3164,578,807.3164,574,811.3164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1115" x2="1125" y1="788.1094" y2="788.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="1125" x2="1125" y1="788.1094" y2="817.3164"/><polygon fill="#181818" points="1121,807.3164,1125,817.3164,1129,807.3164,1125,811.3164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="574" x2="574" y1="865.2539" y2="949.1289"/><line style="stroke:#181818;stroke-width:1.0;" x1="574" x2="837.5" y1="949.1289" y2="949.1289"/><polygon fill="#181818" points="827.5,945.1289,837.5,949.1289,827.5,953.1289,831.5,949.1289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1125" x2="1125" y1="931.1289" y2="949.1289"/><line style="stroke:#181818;stroke-width:1.0;" x1="1125" x2="861.5" y1="949.1289" y2="949.1289"/><polygon fill="#181818" points="871.5,945.1289,861.5,949.1289,871.5,953.1289,867.5,949.1289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="748.9023" y2="768.9023"/><polygon fill="#181818" points="845.5,758.9023,849.5,768.9023,853.5,758.9023,849.5,762.9023" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="961.1289" y2="981.1289"/><polygon fill="#181818" points="845.5,971.1289,849.5,981.1289,853.5,971.1289,849.5,975.1289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="634.4844" y2="654.4844"/><polygon fill="#181818" points="845.5,644.4844,849.5,654.4844,853.5,644.4844,849.5,648.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1046" x2="1425.75" y1="1140.9102" y2="1140.9102"/><polygon fill="#181818" points="1421.75,884.9453,1425.75,874.9453,1429.75,884.9453,1425.75,880.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1425.75" x2="1425.75" y1="617.5" y2="1140.9102"/><line style="stroke:#181818;stroke-width:1.0;" x1="1425.75" x2="1040.5" y1="617.5" y2="617.5"/><polygon fill="#181818" points="1050.5,613.5,1040.5,617.5,1050.5,621.5,1046.5,617.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="1108.9102" y2="1128.9102"/><polygon fill="#181818" points="845.5,1118.9102,849.5,1128.9102,853.5,1118.9102,849.5,1122.9102" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="554.2188" y2="600.5156"/><polygon fill="#181818" points="845.5,590.5156,849.5,600.5156,853.5,590.5156,849.5,594.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="1152.9102" y2="1192.9102"/><polygon fill="#181818" points="845.5,1182.9102,849.5,1192.9102,853.5,1182.9102,849.5,1186.9102" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="237.5" x2="177.5" y1="267.5313" y2="267.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="177.5" x2="177.5" y1="267.5313" y2="289.5313"/><polygon fill="#181818" points="173.5,279.5313,177.5,289.5313,181.5,279.5313,177.5,283.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="789.5" x2="849.5" y1="267.5313" y2="267.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="267.5313" y2="289.5313"/><polygon fill="#181818" points="845.5,279.5313,849.5,289.5313,853.5,279.5313,849.5,283.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="849.5" y1="1240.8477" y2="1245.8477"/><line style="stroke:#181818;stroke-width:1.0;" x1="849.5" x2="1060.75" y1="1245.8477" y2="1245.8477"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.75" x2="1060.75" y1="1245.8477" y2="1260.8477"/><polygon fill="#181818" points="1056.75,1250.8477,1060.75,1260.8477,1064.75,1250.8477,1060.75,1254.8477" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1575.25" x2="1575.25" y1="289.5" y2="324.5"/><polygon fill="#181818" points="1571.25,314.5,1575.25,324.5,1579.25,314.5,1575.25,318.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="987.25" x2="513.5" y1="233.5313" y2="233.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="513.5" x2="513.5" y1="233.5313" y2="255.5313"/><polygon fill="#181818" points="509.5,245.5313,513.5,255.5313,517.5,245.5313,513.5,249.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1134.25" x2="1575.25" y1="233.5313" y2="233.5313"/><line style="stroke:#181818;stroke-width:1.0;" x1="1575.25" x2="1575.25" y1="233.5313" y2="255.5313"/><polygon fill="#181818" points="1571.25,245.5313,1575.25,255.5313,1579.25,245.5313,1575.25,249.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.75" x2="1060.75" y1="201.5313" y2="221.5313"/><polygon fill="#181818" points="1056.75,211.5313,1060.75,221.5313,1064.75,211.5313,1060.75,215.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.75" x2="1060.75" y1="147.5625" y2="167.5625"/><polygon fill="#181818" points="1056.75,157.5625,1060.75,167.5625,1064.75,157.5625,1060.75,161.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1250.25" x2="1712.75" y1="1272.8477" y2="1272.8477"/><polygon fill="#181818" points="1708.75,708.4531,1712.75,698.4531,1716.75,708.4531,1712.75,704.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1712.75" x2="1712.75" y1="130.5781" y2="1272.8477"/><line style="stroke:#181818;stroke-width:1.0;" x1="1712.75" x2="1259.25" y1="130.5781" y2="130.5781"/><polygon fill="#181818" points="1269.25,126.5781,1259.25,130.5781,1269.25,134.5781,1265.25,130.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.75" x2="1060.75" y1="67.2969" y2="113.5938"/><polygon fill="#181818" points="1056.75,103.5938,1060.75,113.5938,1064.75,103.5938,1060.75,107.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.75" x2="1060.75" y1="1284.8477" y2="1324.8477"/><polygon fill="#181818" points="1056.75,1314.8477,1060.75,1324.8477,1064.75,1314.8477,1060.75,1318.8477" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.75" x2="1060.75" y1="1358.8164" y2="1378.8164"/><polygon fill="#181818" points="1056.75,1368.8164,1060.75,1378.8164,1064.75,1368.8164,1060.75,1372.8164" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[ac78b07ae823c4f972273209522c32a2]
@startuml operation.provide-dispensation
skinparam defaultTextAlignment center
skinparam title {
  backgroundColor SkyBlue
  borderColor Gray
} 
title $provide-dispensation

start
partition transaction {
  repeat:Get next Item from Operation Parameter RxDispensation List;
    :Validate all <b>Medication</b>, <b>Organization</b> and <b>Practitioner</b> for the RxDispensation from Operation parameter;
    
    if (Validation successfull) then (yes)
      
      if(If <b>MedicationRequest</b> with <b>RxPrescriptionProcessIdentifier</b> exists in Medication Service) then (no)
        
        #Pink:Return "OperationOutcome (duplicate failure)";
        end   
      
      else (yes)
        
        :Set all <b>MedicationDispense</b> with the 
        extension[RxPrescriptionProcessIdentifier] equal to <b>RxPrescriptionProcessIdentifier</b> from Item of the RxDispensation 
        in the Medication Service to Status <b>declined</b>;

        :Set all <b>Medication</b> with the 
        extension[RxPrescriptionProcessIdentifier] equal to <b>RxPrescriptionProcessIdentifier</b>
        to Status <b>inactive</b>;

        :<< Create or Update >> 
        <b>Organization</b>
        ====
        identifier[TelematikID] = Value(TelematikID)
        ...;

        partition loop {
          
          repeat: Get next <b>MedicationDispense</b> from the RxDispensation

          :Get the related <b>Medication</b> for the <b>MedicationDispense</b> from the RxDispensation;

          :Generate Hash for <b>EPAMedicationUniqueIdentifier</b>;
          
          If(Verify whether there is a <b>Medication</b> with the <b>RxPrescriptionProcessIdentifier</b>\nand\n the generated hash for the <b>EPAMedicationUniqueIdentifier</b> in the Medication Service) then (yes)
            
            :Update <b>Medication</b> with <b>RxPrescriptionProcessIdentifier</b>
            and <b>EPAMedicationUniqueIdentifier</b> to Status <b>active</b>;

          else (no)

            :<< Create >> 
            <b>Medication</b>
            ====
            identifier[<b>EPAMedicationUniqueIdentifier</b>] = Value(Generated Hash)
            extension[<b>RxPrescriptionProcessIdentifier</b>] = Value(RxPrescriptionProcessIdentifier)
            status = <b>active</b>
            ...;

          endif

          :<< Create >>
          <b>MedicationDispense</b>
          =====
          extension[<b>RxPrescriptionProcessIdentifier</b>] = Value(RxPrescriptionProcessIdentifier)
          medicationReference = Reference(<b>Medication</b>)
          performer.actor = Reference(<b>Organization</b>)
          authorizingPrescription = Reference(<b>MedicationRequest</b>)
          status = <b>completed</b>;

          repeat while (If next <b>MedicationDispense</b> in Operation Parameter List exists) is (yes) not (no)
        }
        
        :Set <b>MedicationRequest</b> with <b>RxPrescriptionProcessIdentifier</b> 
        to Status <b>completed</b>;
     
      endif

    else (no)
      
      #Pink:Return "OperationOutcome (failure)";
      end
    
    endif
  
  repeat while (If next Item in Operation Parameter RxDispensation List exists) is (yes) not (no)
}

#PaleGreen:Return "OperationOutcome (success)";
stop    
@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>